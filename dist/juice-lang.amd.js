/* @pollon/juice-lang - v1.0.0
* https://github.com/pollon-js/juice-lang#readme
* 2020 Francesco Lasaracina. Licensed ISC */
define(["exports"],(function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e,t,n){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}var c=new(function(){function e(n,r){t(this,e),this.commands={},this.behaviours={}}return r(e,null,[{key:"checkCommandType",value:function(e){return e&&e.name&&e.execute}},{key:"checkBehaviourType",value:function(e){return e&&e.name&&e.execute}}]),r(e,[{key:"addCommand",value:function(t){e.checkCommandType(t)&&(this.commands[t.name]||(this.commands[t.name]=t))}},{key:"removeCommand",value:function(t){e.checkCommandType(t)&&this.commands[t.name]&&(this.commands[t.name]=void 0)}},{key:"addBehaviour",value:function(t){e.checkBehaviourType(t)&&(this.behaviours[t.name]||(this.behaviours[t.name]=t))}},{key:"removeBehaviour",value:function(t){e.checkBehaviourType(t)&&this.behaviours[t.name]&&(this.behaviours[t.name]=void 0)}}]),e}()),l=function(e){var t,n,r;for(t in n=c.behaviours)if(r=n[t].canParse(e)){r=n[t];break}if(!r)throw new Error("Juice: Behaviour `"+e.toString("utf-8")+"` not recognized!");return r};function f(e){return e=Array.isArray(e)?e:[e],new RegExp("^"+e.join("|"),"i")}var h=function(){function e(n,r,o){t(this,e),this.name=n,this.keyword=r,this.strategy=o}return r(e,[{key:"canParse",value:function(e){return f(this.keyword).test(e)}},{key:"parse",value:function(e){return f(this.keyword).exec(e)}},{key:"execute",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if((e=n.shift())&&this.canParse(e.trim()))return n.unshift(this.parse(e)),this.strategy.apply(this,n)}}]),e}(),m=function(e){function n(e,r,o){return t(this,n),a(this,i(n).call(this,e,r,o))}return o(n,e),n}(h),d=function(e){function n(e,r,o){return t(this,n),r=Array.isArray(r)?r:[r],a(this,i(n).call(this,e,r,o))}return o(n,e),n}(h),v=function(e){var t,n,r,o;for(r in console.log("%cJuice Nutrition Table","font-weight:bold; font-size:18px"),o=[],console.groupCollapsed("Commands"),n=c.commands)Object.prototype.hasOwnProperty.call(n,r)&&o.push({name:n[r].name,keyword:n[r].keyword});for(r in console.table(o),console.groupEnd(),o=[],console.groupCollapsed("Behaviours"),t=c.behaviours)Object.prototype.hasOwnProperty.call(t,r)&&o.push({name:t[r].name,keyword:t[r].keyword.join(", ")});return console.table(o),console.groupEnd(),!0},p=function(e){function n(){return t(this,n),a(this,i(n).call(this,"help","help!",v))}return o(n,e),n}(m),y=function(){},g=function(e,t){var n,r,o,i,u=1;return"dynamic"==(i=this.name.split(".").pop())&&(i=t[u],u++),n=t[u++],r=l(t[u].trim()),o=t[u].trim(),document["juice-domevents-".concat(i,"-on-").concat(n)]=function(t){for(var i=t.target;i&&i!=this;i=i.parentNode)if(i.matches(n)){r.execute(o,i),e(t,i);break}},document.addEventListener(i,document["juice-domevents-".concat(i,"-on-").concat(n)]),!0},b=function(e){function n(e,r,o){var u;return t(this,n),(u=a(this,i(n).call(this,e,r,y))).strategy=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return g.apply(this,[o].concat(t))},u}return o(n,e),n}(m),k=function(){},w=function(e){var t,n,r;return t=e[1],n=l(e[2].trim()),r=e[2].trim(),document["juice-transitionend-on-".concat(t)]=function(e){for(var o=e.target;o&&o!=this;o=o.parentNode)if(o.matches(t)){n.execute(r,o);break}},document.addEventListener("transitionend",document["juice-transitionend-on-".concat(t)]),!0},C=function(e){function n(){var e;return t(this,n),(e=a(this,i(n).call(this,"CSS.TransitionEnd",'when transition ends on "([^"]+)"\\s(.*)',k))).strategy=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return w.apply(this,t)},e}return o(n,e),n}(m),A=function(){},O=function(e){function n(e,r){return t(this,n),a(this,i(n).call(this,e,r,A))}return o(n,e),r(n,[{key:"parse",value:function(e){return{behaviour:(e=s(i(n.prototype),"parse",this).call(this,e))[1].trim(),value:e[2].trim(),target:e[3].trim()}}}]),n}(d);function j(e,t){if("parent"==t)return[e.parentNode];if(/parent\(([^"]+)\)/.test(t)){var n=t.match(/parent\(([^"]+)\)/);return[e.closest(n[1])]}switch(t){case"target":case"this":case"it":case"itself":case void 0:return[e];default:return document.querySelectorAll(t)}}var E=function(e,t){var n,r,o;o=j(t,e.target),e.behaviour="s"==e.behaviour.charAt(e.behaviour.length-1)?e.behaviour.substring(0,e.behaviour.length-1):e.behaviour,n="toggle","set"==e.behaviour?n="setAttribute":"remove"==e.behaviour&&(n="removeAttribute"),r=e.value.trim().split(" to "),"toggle"!=n?[].forEach.call(o,(function(e){"setAttribute"==n?r.length>1?e.setAttribute(r[0].trim(),r[1].trim()):e.setAttribute(r[0].trim(),!0):"removeAttribute"==n&&e.removeAttribute(r[0].trim())})):[].forEach.call(o,(function(e){e.getAttribute(r[0].trim())?e.removeAttribute(r[0].trim()):r.length>1?e.setAttribute(r[0].trim(),r[1].trim()):e.setAttribute(r[0].trim(),!0)}))},x=function(e){function n(){var e;return t(this,n),(e=a(this,i(n).call(this,"DOM.attribute",'(set|sets|remove|removes|toggle|toggles) attribute "([^"]+)" on "([^"]+)"'))).strategy=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return E.apply(this,t)},e}return o(n,e),n}(O),M=function(e,t){var n,r;r=j(t,e.target),n="s"==e.behaviour.charAt(e.behaviour.length-1)?e.behaviour.substring(0,e.behaviour.length-1):e.behaviour,[].forEach.call(r,(function(t){t.classList[n](e.value)}))},_=function(e){function n(){var e;return t(this,n),(e=a(this,i(n).call(this,"DOM.classList",'(add|adds|remove|removes|toggle|toggles) class "([^"]+)" on "([^"]+)"'))).strategy=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return M.apply(this,t)},e}return o(n,e),n}(O),P=function(){},B=function(e,t){"a"==t.nodeName.toLowerCase()&&e.preventDefault()},T=[{name:"Mouse.click",keyword:'clicking on "([^"]+)"\\s(.*)',sink:B},{name:"Mouse.dblclick",keyword:'double clicking on "([^"]+)"\\s(.*)',sink:B},{name:"Mouse.mousedown",keyword:'holding down on "([^"]+)"\\s(.*)',sink:P},{name:"Mouse.mouseenter",keyword:'hovering in "([^"]+)"\\s(.*)',sink:P},{name:"Mouse.mouseleave",keyword:'hovering away from "([^"]+)"\\s(.*)',sink:P},{name:"Mouse.mousemove",keyword:'moving on "([^"]+)"\\s(.*)',sink:P},{name:"Mouse.mouseout",keyword:'hovering out "([^"]+)"\\s(.*)',sink:P},{name:"Mouse.mouseover",keyword:'hovering on "([^"]+)"\\s(.*)',sink:P},{name:"Mouse.mouseup",keyword:'when released "([^"]+)"\\s(.*)',sink:P},{name:"Mouse.focusin",keyword:'focusing on "([^"]+)"\\s(.*)',sink:P},{name:"Mouse.focusout",keyword:'focusing out from "([^"]+)"\\s(.*)',sink:P},{name:"DomEvents.dynamic",keyword:'when dom emits "([^"]+)" on "([^"]+)"\\s(.*)',sink:B}];c.addCommand(new p),T.forEach((function(e){c.addCommand(new b(e.name,e.keyword,e.sink))})),c.addCommand(new C),c.addBehaviour(new _),c.addBehaviour(new x);var Q=function(e){(function(e){var t=[];return e.toString("utf8").split(/;|\r\n|[\n\r\u0085\u2028\u2029]/g).forEach((function(e){(e=function(e){var t,n,r;for(n={singleQuote:!1,doubleQuote:!1,regex:!1,blockComment:!1,lineComment:!1,condComp:!1},t=0,r=(e=("__"+e+"__").split("")).length;t<r;t++)if(n.regex)"/"===e[t]&&"\\"!==e[t-1]&&(n.regex=!1);else if(n.singleQuote)"'"===e[t]&&"\\"!==e[t-1]&&(n.singleQuote=!1);else if(n.doubleQuote)'"'===e[t]&&"\\"!==e[t-1]&&(n.doubleQuote=!1);else if(n.blockComment)"*"===e[t]&&"/"===e[t+1]&&(e[t+1]="",n.blockComment=!1),e[t]="";else if(n.lineComment)("\n"===e[t+1]||"\r"===e[t+1])&&(n.lineComment=!1),e[t]="";else if(n.condComp)"@"===e[t-2]&&"*"===e[t-1]&&"/"===e[t]&&(n.condComp=!1);else if(n.doubleQuote='"'===e[t],n.singleQuote="'"===e[t],"/"===e[t]){if("*"===e[t+1]&&"@"===e[t+2]){n.condComp=!0;continue}if("*"===e[t+1]){e[t]="",n.blockComment=!0;continue}if("/"===e[t+1]){e[t]="",n.lineComment=!0;continue}n.regex=!0}return e.join("").slice(2,-2)}(e.trim()))&&t.push(e)})),t})(e).forEach((function(e){var t,n;t=e.trim(),t=Array.isArray(t)?t:[t],n=c.commands,t.forEach((function(e){var t;if(e){for(var r in n)if(t=n[r].execute(e))break;if(!t)throw new Error("Juice: Command `"+e+"` not recognized!");return t}}))}))};String.prototype.squeeze=function(){Q(this)};e.Behaviour=d,e.Command=m,e.Rule=h,e.Ruleset=c,e.findBehaviour=function(e){return l(e)},e.parse=Q,Object.defineProperty(e,"__esModule",{value:!0})}));
